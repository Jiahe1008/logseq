# 存储器管理
- ## 概述
	- 地址空间
	- 存储空间
	- 地址重定位
		- 动态重定位：
			- 主存利用充分
			- 允许程序不必占有连续的存储区域
			- 便于多用户共享存储器中的同一程序和数据
	- 存储器保护
	- 存储器共享
- ## 单用户单道程序
- ## 多用户多道程序
	- **固定式分区**
	- **可变式分区**
		- 分区说明表
			- 已分配区表
			- 未分配区表
		- 空闲区链
			- first fit
			- best fit
			- worst fit
	- **分区管理的地址重定位和存储器保护**
		- 固定式分区采用静态重定位，可变式分区采用动态重定位
		- 固定式分区：
			- 静态重定位
			- 使用两个界限寄存器来实现存储器保护。
		- 可变式分区：
			- 基地址寄存器+限长寄存器。
	- **分区管理优缺点**
		- 优点
			- 实现了多道程序共享内存
			- 实现分区管理的系统设计相对简单
			- 存储器保护手段也简单
		- 缺点
			- 主存利用不充分
			- 没有实现主存扩充问题
- ## 覆盖与交换
	- 覆盖
		- 需要提供进程的覆盖结构
	- 交换
		- 交换发生的时机：
			- 进程用完分配的时间片或者等待输入/输出
			- 进程要求扩充其占用的存储区而得不到满足
- ## 页式存储器管理
	- 页式管理的实现原理
		- 将主存分成页框
	- 页式动态地址变换
	- 快表和联想存储器TLB
	- 页式管理的主存分配好保护
		- 页式主存分配
			- 页表
			- 进程控制块
			- 存储空间使用情况表
				- 位示图
				- 存储分块表
- ## 段式存储器管理
- ## 虚拟存储器管理
	- 页式虚拟存储器管理
		- 外页表，记录虚拟页 $\rightarrow$ 磁盘扇区地址
		- **页面淘汰算法**
			- OPT
			- FIFO
			- LRU
			- 时钟页面置换算法
		- 设计时应该考虑的问题
			- 交换区的管理
			- 页面尺寸
			- 页的共享
			- 多级页表的结构
			- 写时复制技术
	- 段式虚拟存储器管理
- 练习题
	- 4-1
	- 4-2
	- 4-3
	- 4-4
		- ### 1. 内存分配与回收 (Allocation & Deallocation) —— 资源的管家
		  
		  这是最基础的活儿。每当一个进程出生（`fork`）或者程序申请空间（`malloc`），存储器管理就要在物理内存这块地皮上划出一块来。
		- **它的挑战**：**碎片化 (Fragmentation)**。
		- **系统之神的视角**：
			- **冯·诺依曼**：我们要确保指令和数据都有自己的容身之所。
			- **Linus**：内核必须决定是给它一个整块（伙伴系统），还是给它一堆散碎的页。当程序运行结束，管理程序必须像清洁工一样把地扫干净（`free`），否则摩尔定律给再多内存也会被**内存泄漏 (Memory Leak)** 吞噬。
		- ### 2. 地址转换 (Address Mapping / Translation) —— 幻觉的构建者
		  
		  这是我最得意的杰作。它负责将程序员看到的**逻辑地址**转换成硬件认的**物理地址**。
		- **核心目标**：实现**程序重定位**。
		- **系统之神的视角**：
			- **图灵**：每个程序都觉得自己拥有从 0 到 $2^{64}-1$ 的完整纸带。
			- **诺伊斯**：硬件 MMU（内存管理单元）必须在纳秒级完成这种“虚实转换”。
			- **功能意义**：因为有了地址转换，程序可以被加载到主存的任何角落，甚至在运行中被搬家，而程序逻辑对此一无所知。
		- ### 3. 存储保护 (Memory Protection) —— 法律的执行者
		  
		  如果没有保护，任何一个愚蠢的指针错误（如 `*p = 0`）都可能改写内核的代码，导致整个系统崩溃。
		- **执行手段**：页表里的权限位（R/W/X，只读、可写、可执行）。
		- **系统之神的视角**：
			- **Linus**（咆哮）：如果你试图写一个只读的页，我会毫不犹豫地扔给你一个 `Segmentation Fault` 并杀掉你的进程！
			- **功能意义**：它确保进程 A 无法读写进程 B 的内存，用户进程无法修改内核数据。这是现代操作系统**稳定性**的根基。
		- ### 4. 存储扩充 (Memory Expansion / Virtual Memory) —— 空间的大师
		  
		  这是最神奇的功能。通过**交换 (Swapping)** 和 **按需分页 (Demand Paging)**，它让程序员觉得内存是无限的。
		- **实现手段**：利用磁盘作为“备胎”，实现**虚拟存储器**。
		- **系统之神的视角**：
			- **摩尔**：虽然 DRAM 越来越大，但用户的贪婪（需求）增长得更快。
			- **功能意义**：它让 16GB 的物理内存能跑起总需求 100GB 的多个进程。它只把“当前最活跃”的数据留在昂贵的物理内存里，不常用的统统扔进廉价的磁盘。