## 微处理器基本结构
	- 接口单元BIU
		- 数据总线
		- 地址总线
		- 控制总线
	- 中央处理单元CPU
		- 指令部件IU
			- 指令预取单元IPU
			- 指令译码单元IDU
		- 执行部件EU
			- 8个通用寄存器
			- 32位算术单元ALU
			- 64位桶形移位器和乘除单元
	- 存储器管理单元MMU
		- 分段部件
		- 分页部件
- ## CPU工作模式
	- ### 实模式
	- ### 保护模式
	- ### 虚拟8086模式
	- ### 64位模式
- ## 寄存器
	- ### 程序可见寄存器
		- #### 通用寄存器
			- |64位|32位|16位|8位|
			  |---|---|---|---|
			  |RAX|EAX|AH|AL|
			  |RBX|EBX|BH|BL|
			  |RCX|ECX|CH|CL|
			  |RDX|EDX|DH|DL|
			  |RBP|EBP|BP||
			  |RSI|EST|SI||
			  |RDI|EDT|DI||
			  |RSP|ESP|SP||
			  |R8-R15|
			- R8-R15寄存器可以通过添加控制字来访问寄存器的低位。64位访问不需要控制字。
				- |访问位数|控制字|寄存器位置|示例|
				  |---|---|---|---|
				  |8|B|7-0||
				  |16|W|15-0||
				  |32|D|31-0||
				  |64||63-0||
		- #### 段寄存器
			- 代码段寄存器 CS
				- 寄存器最低2位存储CPL（当前运行特权级）
			- 数据段寄存器 DS
			- 堆栈段寄存器 SS
			- 附加数据段寄存器 ES
			- 实模式下存储正在运行程序的段基址高16位，保护模式下存储正在运行程序的段选择符。
		- #### 专用寄存器
			- 指令指针寄存器 IP/EIP/RIP
			- 堆栈指针寄存器 SP/ESP/RSP
			- 标志寄存器 FLAG/EFLAG/RFLAG
	- ### 保护模式下寄存器
		- #### 控制寄存器
			- 80386有4个控制寄存器CR0-CR3. （32位寄存器）
			- CR0
				-
				- CR0 低五位系统控制标志。
					- |位|名字|描述|
					  |0|PE|保护模式允许标志; 0为实模式，1为保护模式|
					  |1|MP|运算协处理器存在位|
					  |2|EM|仿真位，使ESC指令引起7号中断|
					  |3|TS||
					  |4|ET||
					  |31|PG|分页标志|
			- CR1
				- CR1保留未用
			- CR2
				- 页面故障线性地址寄存器。用于发生页异常报告出错信息。（PFLAR）
			- CR3
			  id:: 6943a928-85a9-4feb-ab3f-f9cf331ef874
				- 页目录基址寄存器（PDBR）。
		- #### 调试和测试寄存器
			- 8个32位调试寄存器DR0-DR7
			- 8个32位测试寄存器TR0-TR7
		- #### 全局描述符表寄存器GDTR
			- 48位寄存器。高32位是基址，低16位是限长。
		- #### 中断描述符表寄存器IDTR
		- #### 局部描述符表寄存器LDTR
		- #### 任务寄存器TR
		- #### 段选择符
		  id:: 6943a7f5-3981-4a8a-bc8a-a3c170a0018d
			- 在保护模式下，由段寄存器存储的段选择符，在全局描述符表或者局部描述符表中找到段描述符，从而确定段信息。
			- |格式|位|作用|
			  |RPL|0-1|请求特权级，00-11分别表示特权级0-3|
			  |TI|2|表指示符0-GDT，1-LDT|
			  |Index|3-15||
			-
			-
		-
- ## 内存管理
	- ### 实模式下分段管理
		- 一个内存单元用**段基地址**和**偏移量**描述。
		- 段基地址：偏移量
		- 段基址必须定义在16的整数倍上。
	- ### 保护模式下分段管理
		- 段基址不在表示段起始位置，而是表示 ((6943a7f5-3981-4a8a-bc8a-a3c170a0018d))。
		- #### 段描述符
			- 段描述符位于GDT或LDT内，占8字节64位。
			- 包含段基址32位，限长20位，访问权限8位，属性4位。
				- 0-15位是限长（0-15位），48-51是限长（16-19位）
				- 16-39位（0-23）和56-63位是段基址。
			- 访问权限位
				- |名|位|描述|
				  |P|39|存在位|
				  |DPL|37-38|描述符特权级|
				  |S|36|描述符类型位，1-代码段，数据段，堆栈段，0-系统段描述符|
				  |E|35|**可执行位**，1-代码段，可执行，0-数据段堆栈段，不可执行|
				  |ED|34|E=0时。扩展方向位|
				  |W|33|E=0时。写允许位|
				  |C|34|E=1时。一致位。判断是否是**一致代码段**。|
				  |R|33|E=1时。读允许位。|
				  |A|32|访问位。段是否已经被访问，使用过。|
			- 属性位
				- |名|位|描述|
				  |G|47|粒度，1-限长以页为单位，0-限长以字节为单位|
				  |D|46|默认操作数宽度|
				  |L|45|64位代码段标志|
				  |AVL|44|可用位|
	- ### 页式内存管理
		- #### 分页
		- #### 线性地址到物理地址的映射过程
		- #### 片内转换检测缓冲器TLB
			- 快表
		- #### 页表项
			- 页表描述符和页描述符统称**页表项**，它们结构相同
			- 页表项高20位是基地址，低12位提供保护功能和统计信息。
	- ### 地址补充
		- ### 1. 四种地址的定义
		  
		  | **地址名称** | **英文名称** | **定义与上下文** |
		  | ---- | ---- | ---- |
		  | **逻辑地址** | **Logical Address** | 程序代码中使用的地址，表现为 **`段选择子:偏移量`**（如 `CS:EIP`）。在保护模式下，它不代表物理位置。 |
		  | **线性地址** | **Linear Address** | 逻辑地址经过**分段机制**转换后的结果。它是一个连续的、平坦的 32 位（或 64 位）无符号整数。 |
		  | **虚拟地址** | **Virtual Address** | 在开启**分页机制**后，线性地址通常被称为虚拟地址。它是进程看到的“假”地址空间。 |
		  | **物理地址** | **Physical Address** | 内存条上真实的电信号地址，也是 CPU 最终在地址总线上发出的地址。 |
		- 虚拟地址->线性地址
			- 从虚拟地址（逻辑地址）中获得段选择子，结合GDTR找到GDT中的段描述符，加上逻辑地址中的段偏移，得到32位线性地址。
- ## 任务
	- ### 任务执行环境
	- ### 任务状态段TSS
		- TSS由104字节组成，包含:
		- 寄存器保存区域
		- 内存堆栈指针区域
		- 地址映射寄存器区域
		- 域链接字段区域
		- I/O许可位图
	- ### 门
		- 系统描述符
			- 门描述符是系统描述符S=0
		- 系统描述符type4位
			- |TYPE|含义|TYPE|含义|
			  |0|非法|8|非法|
			  |1|80286 Available TSS|9|80386 Available TSS|
			  |2|LDT|A|保留|
			  |3|80286 Busy TSS|B|80386 Busy TSS|
			  |4|80286 call gate|C|80386 call gate|
			  |5|task gate|D|保留|
			  |6|80286 Interrupt Gate|E|80386 Interrupt Gate|
			  |7|80286 Trap Gate|F|80386 Trap Gate|
		- 调用门
		- 任务门
		- 中断和陷阱门
			- 中断门重置IF=0，陷阱门不对IF做修改。
	- ### 任务切换
		- 在4种情况下发生切换：
			- JMP/CALL 选择了GDT中的TSS
			  logseq.order-list-type:: number
			- JMP/CALL 选择了任务门
			  logseq.order-list-type:: number
			- 发生中断或异常，选择了IDT任务门
			  logseq.order-list-type:: number
			- **FLAGS中NT=1**
			  logseq.order-list-type:: number
		- #### 直接任务切换
		- #### 间接任务切换
- ## 保护
	- ### 数据访问保护
		- 类型检查
		- 限长检查
		- 其他属性检查
		- 特权级检查
			- CPL
			- DPL
			- RPL
	- ### 对程序的保护
		- 段间调用或跳转统称转移，需要使用远跳转或远调用指令。`JMP X:Y` `CALL X:Y`
		- **直接转移的保护**
			- CPL = DPL
			- CPL < DPL
			- CPL > DPL
			- **C= 0时，必须满足CPL=DPL, RPL<=CPL**
		- **间接转移的保护**
	- ### 输入输出保护